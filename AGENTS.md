# AGENTS.md

## Commit Policy

Use Conventional Commits: `type(scope?): subject` (imperative, lowercase).
Prefer types: `feat`, `fix`, `docs`, `refactor`, `test`, `chore`, `build`,
`ci`, `perf`.

Before committing, run and fix all issues:

- `cargo fmt --all -- --check`
- `cargo check --all-targets --all-features`
- `cargo clippy --all-targets --all-features -- -D warnings`
- `cargo test --all-targets --all-features`
- If any Markdown files changed, run `make markdownlint-fix` and then
  `make markdownlint`.

Add or update tests where appropriate to cover new behavior or bug fixes.

## Code Quality And Operations

- Keep `Cargo.lock` up to date whenever dependencies change.
- Avoid `unwrap`/`expect` in production paths; use error propagation or
  structured errors instead.
- Log all AWS/DynamoDB interactions at `trace` level, including their duration.
  On failure, log the error with the same context.
- [`.github/workflows/release.yml`](.github/workflows/release.yml) is
  autogenerated by `cargo-dist`; after changing dist config or release workflow
  settings, regenerate it with `dist generate --mode=ci` and keep it up to
  date.

## Documentation Structure

- [`README.md`](README.md) is the end-user entry point (overview, quick start,
  install).
- [`DEVELOPING.md`](DEVELOPING.md) is the developer entry point and links into
  detailed docs.
- [`docs/CI.md`](docs/CI.md) documents CI policy and local verification
  commands.
- [`docs/RELEASING.md`](docs/RELEASING.md) documents release workflows, secrets,
  and artifacts.
- In Markdown docs, reference repository files with relative links (for
  example, `[docs/CI.md](docs/CI.md)`) instead of plain code-formatted paths.
- Prefer wrapping prose near 80 columns; keep lines at or below 120 columns.

## Rust Toolchain And Modern Features

- Target the latest stable Rust. No web search needed: go directly to
  https://doc.rust-lang.org/stable/releases.html for the current stable
  version, its release date, and changelog. As of 2026-02-07, stable is 1.93.0
  (released 2026-01-22).
- This repo uses the Rust 2024 edition (see [`Cargo.toml`](Cargo.toml)). Keep
  code compatible with the 2024 edition and prefer its idioms.
- Before starting work, read the changelog for each release after June 2024
  (1.80.0+) at https://doc.rust-lang.org/stable/releases.html. Use newly
  stabilized language and library features when they improve clarity or safety,
  and update the list below when adopting new patterns.

## Post-1.79 Highlights (Non-Exhaustive)

- Rust 2024 edition and async closures are stable (1.85).
- `let`-chains in the 2024 edition for multi-condition `if`/`while` (1.88).
- `#[expect]` for lint management with an audit trail (1.81).
- `&raw const`/`&raw mut` operators and `unsafe extern` blocks for FFI (1.82).
- Explicit const-argument inference for generics (1.89).
